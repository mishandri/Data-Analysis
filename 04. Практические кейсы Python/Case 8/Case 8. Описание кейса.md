# Пользовательские сессии

Наш следующий кейс немного похож на предыдущий, но все же отличается. В прошлом мы анализировали активность пользователя во взаимодействии с задачами. Но для бизнеса куда важнее такие вещи как путь пользователя - когда зашел, когда перелистнул страницу, когда дошел до заявки, оставил ли её.

Вот у нас есть некоторая выгрузка по пользователям, где собраны эти данные, пользователь, время визита и страница. Правда часть данных собрана в пока не рассматривавшемся ранее формате - `JSON`. Наверняка многие слышали или даже работали с ним, но на всякий случай дадим краткую справку.

Выгрузка выглядит так:

| user\_id | session                                                                                                                                                   |
| -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| user0    | \["2023-05-06 20:43:45", 1192, \[\["page0", "2023-05-06 20:49:36"\], \["page1", "2023-05-06 20:57:32"\], ... \]\]                                         |
| user1    | \["2023-05-03 15:39:47", 1642, \[\["page0", "2023-05-03 15:42:04"\], \["page1", "2023-05-03 16:06:25"\], ... \]\]                                         |
| user1    | \["2023-05-16 21:24:30", 506, \[\["page0", "2023-05-16 21:26:08"\], \["page1", "2023-05-16 21:25:40"\], \["page2", "2023-05-16 21:27:11"\], ... \]\]      |
| user1    | \["2023-05-09 01:41:35", 1004, \[\["page0", "2023-05-09 01:48:18"\], \["page1", "2023-05-09 01:46:54"\], ..., \["conversion", "2023-05-09 01:41:52"\]\]\] |
| user1    | \["2023-05-26 05:31:50", 984, \[\["page0", "2023-05-26 05:43:34"\], \["page1", "2023-05-26 05:35:54"\], \["page2", "2023-05-26 05:39:05"\]\]\]            |

По каждому пользователю приведена `JSON` строка с его сессией. Первая дата - начало данной сессии, затем число - длительность данной сессии в секундах, а далее список списков, где собраны последовательная информация о посещенных страницах и времени посещения. У каких-то пользователей будет страница `conversion`, как у `user1` в третьей сесии, это - совершение целевого действия.

В этом контексте у команды также может быть много вопросов, например:

- Сколько времени обычно проходит между заходом на сайт и целевым действием
- Сколько вообще в среднем длится сессия
- Сколько разных заходов в течение дня делает пользователь
- И сколько заходов вообще в среднем делает пользователь

Вот такая небольшая аналитическая работа.

Все должно быть для вас привычно и понятно, но подозреваем, что могут возникнуть сложности с `JSON`, поэтому дадим небольшие комментарии.

**Что понадобится сделать?**

- Прочитать файл
- Десериализовать каждую JSON-строку в объект Python
- Преобразовать даты и время к типу `datetime`
- И в каком вам удобно формате сохранить себе данные

Загадочное слово десериализовать... На самом деле оно означает простое преобразование `JSON` строки, обратно в объекты или значения. Потому что когда данные сериализуются в формат `JSON`, они конвертируются в **строку**, чтобы их можно было передавать через сеть или сохранять в файл. А для того, чтобы работать с ними снова, их необходимо десериализовать. В большинстве языков программирования существуют встроенные средства для десериализации JSON-строк, как и в Python.

Вам понадобится импортировать дополнительный модуль - `json`. И использовать метод `.loads()`, который принимает на вход строку и возвращает объект Python. Но есть нюанс, было бы удобно сразу конвертировать все строковые представления дат в объекты `datetime`, согласны?

Для этого метод `.loads()` способен принимать опцию `object_hook`. Эта опция позволяет передать функцию-обработчик, которая будет вызываться при декодировании каждого объекта в JSON-данных. Таким образом, мы можем задать собственную функцию, принимающую JSON словарь, и выполняющую специфическую обработку полей даты и времени. Например, преобразовывать значения из строкового формата в объекты `datetime.datetime`.

И еще вам наверняка понадобится `.fromisoformat()`, но это так - напоминание. Мы знаем, что вы все помните!

После всех этих манипуляций вы сможете сохранить данные в любой, подходящий вам формат и наконец проанализировать пользовательские сессии.
