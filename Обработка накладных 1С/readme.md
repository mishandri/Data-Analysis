# Выполнено

Проведены работы для формирования витрины данных из выгруженных накладных из 1С

# Описание задачи

Ваша компания «переезжает» с упрощенной системы налогообложения на общую. К вам подошел главный бухгалтер с просьбой:

> В нашей сети около 100 аптек. Нам нужно единоразово загрузить файл в 1С, но для этого надо сделать сравнение реализации по аптекам и выгрузки из СБИСа. Пункты, которые расходятся, мы подправим вручную. После этого будем загружать в 1С. Подробная информация ниже.

- Выгрузка из СБИС находится в папке `Входящие`. Загрузите все `csv` файлы в один датафрейм. Если встретился файл с другим расширением, то его пропускаем. Будьте аккуратны с заголовками столбцов - не мешайте их с данными при объединении нескольких файлов.
- Дайте столбцам полученного датафрейма такие названия:

```
"Дата",
"Номер",
"Сумма",
"Статус",
"Примечание",
"Комментарий",
"Контрагент",
"ИНН/КПП",
"Организация",
"ИНН/КПП",
"Тип документа",
"Имя файла",
"Дата",
"Номер 1",
"Сумма 1",
"Сумма НДС",
"Ответственный",
"Подразделение",
"Код",
"Дата",
"Время",
"Тип пакета",
"Идентификатор пакета",
"Запущено в обработку",
"Получено контрагентом",
"Завершено",
"Увеличение суммы",
"НДC",
"Уменьшение суммы",
"НДС"
```

- Все названия из нескольких слов сцепите через нижнее подчеркивание в `одно_длинное_слово`.
- Файлы с выгрузкой из аптек находятся в папке `Аптеки/csv/correct/`.
- Загружайте на обработку по одному файлу. Содержимое каждого файла загружайте в датафрейм Pandas. Если встречаете не `csv` формат - игнорируйте его.

Создайте столбцы:

```
"Номер счет-фактуры"
"Сумма счет-фактуры"
"Дата счет-фактуры"
"Сравнение дат"
```

В каждой строке проверьте:

1. Если `"Поставщик"` - `ЕАПТЕКА`, то к `"Номер накладной"` нужно добавить `/15`.
2. Нужно найти все записи в выгрузке из СБИСа по данному номеру накладной
3. Из найденных строк нужно оставить только те, которые имеют один из типов документа: `["СчФктр", "УпдДоп", "УпдСчфДоп", "ЭДОНакл"]`
4. Если ничего не найдено - просто переходим к следующей строке
5. Если найдено - нужно сохранить значения `Номер`, `Сумма` и `Дата`
6. Дату нужно представить в формате `25.05.2021`
7. В столбцы из пункта 6 нужно записать найденные для данной строки значения
8. В столбец `Сравнение дат` помещаем `"Не совпадает!"`, если найденная дата и дата накладной отличаются. Иначе - пустая строка.

> Обратите внимание: если по заданным условиям находится несколько подходящих документов - выбираем значения из первого найденного. Это означает, что если у документов разные суммы, берется та, что стоит первой в выгрузке из СБИС.

Итоговый файл выгрузки по аптеке должен содержать такие столбцы в заданном порядке:

```
'№ п/п', 'Штрих-код партии', 'Наименование товара', 'Поставщик',
'Дата приходного документа', 'Номер приходного документа',
'Дата накладной', 'Номер накладной', 'Номер счет-фактуры',
'Сумма счет-фактуры', 'Кол-во',
'Сумма в закупочных ценах без НДС', 'Ставка НДС поставщика',
'Сумма НДС', 'Сумма в закупочных ценах с НДС', 'Дата счет-фактуры', 'Сравнение дат'
```

Файл сохраните по пути `Результат/{полная сегодняшняя дата}/{имя исходного файла без расширения} - результат.xlsx`. Если таких папок не существует - создайте их (проверку и создание нужно реализовать средствами Python, автоматически).
