# Итоговый проект Python

Само задание можно посмотреть в фале "[ТЗ_проекта.md](ТЗ_проекта.md)"

1. Так как таблица в БД создаётся один раз, а данные потом просто заносятся в неё, то было решено создать её через DBeaver:

   ```pgsql
   CREATE TABLE IF NOT EXISTS users (
       user_id VARCHAR NOT NULL,
       oauth_consumer_key VARCHAR NOT NULL,
       lis_result_sourcedid VARCHAR,
       lis_outcome_service_url VARCHAR,
       is_correct VARCHAR(1),  -- Например, "1"/"0" или Null
       attempt_type VARCHAR(6), -- Например, "run"/"submit"
       created_at TIMESTAMP
   );
   ```
2. Для подключения к локальной БД используется класс `ConnectDB`, который является синглтоном.
3. Для загрузки данных черех `API` создал отдельный класс `APIClient`, в котором есть функция `fetch_data` формирующая полученные данные в список из словарей с данными.
4. Осуществлено логировие. Примерный вид:

   ```plaintext
   2025-04-13 19:23:20,668 INFO: Запуск программы...
   2025-04-13 19:24:00,239 INFO: Данные из API получены
   2025-04-13 19:24:00,239 INFO: Начата обработка данных
   2025-04-13 19:24:00,239 WARNING: Обнаружено пустое значение в ключе oauth_consumer_key
   2025-04-13 19:24:00,241 WARNING: Обнаружено пустое значение в ключе lis_outcome_service_url
   2025-04-13 19:24:00,462 INFO: Обработка данных закончена
   2025-04-13 19:24:00,547 INFO: Соединение с БД "postgres:5432" установлено
   2025-04-13 19:24:00,914 INFO: Данные успешно занесены в БД
   2025-04-13 19:24:00,914 INFO: Соединение с БД "postgres:5432" закрыто
   2025-04-13 19:24:00,915 INFO: Формируется отчёт в формате xlsx
   2025-04-13 19:24:00,924 INFO: Данные успешно добавлены
   2025-04-13 19:24:02,724 INFO: Отчёт в формате xlsx загружен на Я.Диск
   2025-04-13 19:24:03,432 INFO: E-mail успешно отправлен!
   2025-04-13 19:24:03,432 INFO: Работа программы успешно завершена
   ```
5. Удаление старых логов происходит через функцию `delete_old_log(days=3,folder='.')`. Вообще, функция удаляет любые файлы с расширением `.log` в указанных в параметрах директории `folder` и старше `days` дней.
6. Подключение к Я.Диску сделано через класс `YandexDisk`. В котором есть метод `report`, принимающий на вход `имя файла` и сохраняющй его в файл `/python/Отчёт.xlsx` на Я.Диске.
7. Отчёт формируется автоматически и доступен по [ссылке](https://disk.yandex.ru/i/dqu9f-5ijZLzjQ).
8. Реализована функция отправки сообщения об окончании работы алгоритма по электронной почте.
9. Пароли для доступа к Я.Диску и E-mail находятся в файлах локально, без выгрузки в репозиторий.
