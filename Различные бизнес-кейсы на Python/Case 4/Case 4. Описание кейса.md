# Кейс 4. Обработка логов

**Логи** - это записи событий, которые происходят в компьютерной системе или приложении. Эти записи содержат информацию о том, как система или приложение работают в реальном времени. Логи используются для отслеживания ошибок, улучшения производительности, обнаружения злоумышленных действий и многого другого.

Использование логов является неотъемлемой частью разработки программного обеспечения и поддержки систем. Но это не только "игрушка" разработчиков, очень часто это на самом деле "игрушка" аналитиков. Изучение логов помогает инженерам и администраторам понимать, что происходит в системе, выявлять проблемы и находить способы их решения.

На практике, компании даже настраивают целые дашборды, чтобы вовремя увидеть проблему и превентивно ее вылечить.

Теперь, когда мы понимаем, что такое логи и почему они важны, давайте поговорим о **кейсе**.

Мы поделимся с вами данными по автопродлениям подписок нашей платформы и попросим вас сделать важную аналитическую работу.

Перед вами будут стоять **три задачи**.

## Первая задача

У нас есть некоторое количество пользователей с подключенным автопродлением подписки. Кто-то её подключает, кто-то отключает. Иногда пользователь может убрать способ оплаты, что вызовет ошибку при списании.

Что нас интересует, так это соотношение успешных автопродлений к неуспешным. Это поднимет вопрос либо к маркетологам, либо, если много технических ошибок - к разработчикам. Задача важная, поэтому давайте немного посвятим вас в контекст.

Файл с логами организован следующим образом:

```
INFO | 2023-01-17 00:12:36,045 | file: demon\_auto\_purchase\_bundle.py | line: 86 | \[demon\] Обновляем подписку пользователю id: 5564, payment\_method\_id: 2b2db0d5 
ERROR | 2023-01-17 00:13:06,195 | file: demon\_auto\_purchase\_bundle.py | line: 93 | \[demon\] У пользователя с id: 5564 - ошибка при списании:
INFO | 2023-01-18 00:01:02,395 | file: demon\_auto\_purchase\_bundle.py | line: 53 | \[demon\] Поверяем истекающие премиум-пакеты
INFO | 2023-01-18 00:01:02,433 | file: demon\_auto\_purchase\_bundle.py | line: 76 | \[demon\] Cегодня 2023-01-18, количество людей с автопродлением подписки: 30
INFO | 2023-01-18 00:01:02,438 | file: demon\_auto\_purchase\_bundle.py | line: 86 | \[demon\] Обновляем подписку пользователю id: 63, payment\_method\_id:
INFO | 2023-01-18 00:01:02,438 | file: demon\_auto\_purchase\_bundle.py | line: 98 | \[demon\] У пользователя с id: 63 --> истекает срок подписки. payment\_method\_id = None
INFO | 2023-01-18 00:01:02,438 | file: demon\_auto\_purchase\_bundle.py | line: 86 | \[demon\] Обновляем подписку пользователю id: 157, payment\_method\_id: None
INFO | 2023-01-18 00:01:02,438 | file: demon\_auto\_purchase\_bundle.py | line: 98 | \[demon\] У пользователя с id: 157 --> истекает срок подписки. payment\_method\_id = None
INFO | 2023-01-18 00:01:02,438 | file: demon\_auto\_purchase\_bundle.py | line: 86 | \[demon\] Обновляем подписку пользователю id: 2305, payment\_method\_id: 2b2fc651
ERROR | 2023-01-18 00:01:32,807 | file: demon\_auto\_purchase\_bundle.py | line: 93 | \[demon\] У пользователя с id: 2305 - ошибка при списании:
```

Столбцы в данном файле описывают следующие параметры:

- Уровень важности сообщения (от `INFO` до `ERROR`)
- Время выполнения операции (формат: `год-месяц-день час:минута:секунда, миллисекунды`)
- Имя файла и номер строки кода, где была выполнена операция
- Информация о выполняемой операции

Все сообщения с ошибками о списаниях содержат в первом столбце - `ERROR`. Успешные же продления не содержат после себя строки с ошибкой.

**Формулировка**

Ваша задача - написать функцию `count_success_and_failure`, которая принимает на вход путь к файлу с логами и подсчитывает количество успешных продлений и ошибок при списании. Функция должна вернуть кортеж из двух значений: количества успешных попыток и неуспешных.

## Вторая задача

Замечаете в файле строку, которая сообщает количество людей с автопродлеием подписки на сегодняшний день? Интересная деталь для аналитики, верно?

Давайте посмотрим на изменение количества этих людей за все время наблюдений!

В уроках по Продуктовым метрикам и `SQL` вы уже сталкивались с подобной задачей. Мы хотим получить сглаженные значения: с помощью метода скользящего среднего и метода медианного сглаживания.

Как делаем сглаживание? Берем все предыдущие значения, включая текущее, а будущие значения не берем.

Сможете ли вы реализовать это на питоне? Мы уверены, что да!

Поскольку наблюдений у нас достаточно много, хранить их списком будет сложно, поэтому запишите результат в файл. Примерно так:

**Формулировка**

Ваша задача написать функцию `auto_renewal_sub`, которая принимает на вход путь к файлу с логами и обрабатывает количество клиентов с автопродлением подписки. Мы хотим посмотреть на изменение этого показателя в динамике: посчитайте сглаженные значения с помощью метода скользящего среднего и метода медианного сглаживания. При сглаживании берем все предыдущие значения, включая текущее, будущие значения не берем.

## Третья задача

И последняя задача в этом кейсе, но не последняя по важности и экспериментальности.

Мы предположили, что люди могут более активно приобретать подписки в какие-то определенные дни недели. Это стоит проверить!

Вам необходимо написать функцию `sub_renewal_by_day`, которая принимает на вход путь к файлу с логами и выводит небольшую аналитическую записку.

Нам важно понимать, в какой день сколько было проведено **успешных** продлений, поэтому запишите в файл результаты в формате:

**Формулировка**

Напишите функцию `sub_renewal_by_day`, которая принимает на вход путь к файлу с логами и анализирует взаимосвязь дня продления подписки и количества продлений в этот день. Функция должна записать в файл `weekdays.txt` аналитическую записку в указанном формате.
